sequenceDiagram
    participant Client
    participant Controller as NotificationController
    participant EmailService as EmailService
    participant OtpService as OtpService
    participant Redis as Redis
    participant Gmail as Gmail SMTP

    Note over Client, Gmail: OTP Generation Flow
    Client->>Controller: POST /notifications/otp (Email, Template)
    Controller->>OtpService: generateOtp(Email)
    OtpService->>Redis: GET OTP_LIMIT:{Email}
    alt Count < 5
        OtpService->>Redis: SET OTP:{Email} (10 min expiry)
        OtpService->>Redis: INCR OTP_LIMIT:{Email} (30 min expiry)
        OtpService-->>Controller: 6-digit OTP
        Controller->>EmailService: sendHtmlEmail(Selected Template)
        EmailService->>Gmail: Send MimeMessage
        Controller-->>Client: 200 OK (OTP Sent)
    else Count >= 5
        OtpService-->>Controller: Rate Limit Exception
        Controller-->>Client: 429 Too Many Requests
    end

    Note over Client, Gmail: Template Alert Flow
    Client->>Controller: POST /notifications/alert (Email, Template, Vars)
    Controller->>EmailService: sendHtmlEmail(Template, Vars)
    EmailService->>Gmail: Send MimeMessage
    Controller-->>Client: 200 OK (Alert Sent)